import streamlit as st
import time

if st.session_state.current_page == "qids":
    with st.sidebar:
        st.markdown(f"### 実験の進度")
        st.progress(1 / 5)

    # QIDSアンケート画面
    st.title("抑うつ症状の検査")
    st.write("簡易抑うつ症状尺度の質問（QIDS-J）に回答していただきます。  \n以下の各項目について、**最近1週間**のあなたの状態に最も当てはまるものを1つ選んでください。")
    
    questions = {
        "**Q1: 寝つき**": [
            "問題ない（または、寝付くのに30分以上かかったことは一度もない）",
            "寝つくのに30分以上かかったこともあるが、一週間の半分以下である",
            "寝つくのに30分以上かかったことが、週の半分以上ある",
            "寝つくのに60分以上かかったことが、(1週間の)半分以上ある"
        ],
        "**Q2: 夜間の睡眠**": [
            "問題ない(夜間に目が覚めたことはない)",
            "落ち着かない、浅い眠りで、何回か短く目が覚めたことがある",
            "毎晩少なくとも1回は目が覚めるが、難なくまた眠ることができる",
            "毎晩1回以上目が覚め、そのまま20分以上眠れないことが、(1週間の)半分以上ある"
        ],
        "**Q3: 早く目が覚めすぎる**": [
            "問題ない(または、ほとんどの場合、目が覚めるのは、起きなくてはいけない時間の、せいぜい30分前である)",
            "週の半分以上、起きなくてはならない時間より30分以上早く目が覚める",
            "ほとんどいつも、起きなくてはならない時間より1時間早く目が覚めてしまうが、最終的にはまた眠ることができる",
            "起きなくてはならない時間よりも1時間以上早く起きてしまい、もう一度眠ることができない"
        ],
        "**Q4: 眠りすぎる**": [
            "問題ない(夜間、眠りすぎることはなく、日中に昼寝をすることもない)",
            "24時間のうち、眠っている時間は、昼寝を含めて10時間ほどである",
            "24時間のうち、眠っている時間は、昼寝を含めて12時間ほどである",
            "24時間のうち、昼寝を含めて12時間以上眠っている"
        ],
        "**Q5: 悲しい気持ち**": [
            "悲しいとは思わない",
            "悲しいと思うことは、半分以下の時間である",
            "悲しいと思うことが半分以上の時間ある",
            "ほとんどすべての時間、悲しいと感じている"
        ],
        "**Q6: 食欲低下**": [
            "普段の食欲とかわらない、または、食欲が増えた",
            "普段よりいくぶん食べる回数が少ないか、量が少ない",
            "普段よりかなり食べる量が少なく、食べるよう努めないといけない",
            "まる1日(24時間)ほとんどものを食べず、食べるのは極めて強く食べようと努めたり、誰かに食べるよう説得されたときだけである"
        ],
        "**Q7: 食欲増進**": [
            "普段の食欲とかわらない、または、食欲が減った",
            "普段より頻回に食べないといけないように感じる",
            "普段とくらべて、常に食べる回数が多かったり、量が多かったりする",
            "食事の時も、食事と食事の間も、食べ過ぎる衝動にかられている"
        ],
        "**Q8: 体重減少（最近2週間で）**": [
            "体重は変わっていない、または、体重は増えた",
            "少し体重が減った気がする",
            "1キロ以上やせた",
            "2キロ以上やせた"
        ],
        "**Q9: 体重増加（最近2週間で）**": [
            "体重は変わっていない、または、体重は減った",
            "少し体重が増えた気がする",
            "1キロ以上太った",
            "2キロ以上太った"
        ],
        "**Q10: 集中力/決断**": [
            "集中力や決断力は普段とかわりない",
            "ときどき決断しづらくなっているように感じたり、注意が散漫になるように感じる",
            "ほとんどの時間、注意を集中したり、決断を下すのに苦労する",
            "ものを読むこともじゅうぶんにできなかったり、小さなことすら決断できないほど集中力が落ちている"
        ],
        "**Q11: 自分についての見方**": [
            "自分のことを、他の人と同じくらい価値があって、援助に値する人間だと思う",
            "普段よりも自分を責めがちである",
            "自分が他の人に迷惑をかけているとかなり信じている",
            "自分の大小の欠陥について、ほとんど常に考えている"
        ],
        "**Q12: 死や自殺についての考え**": [
            "死や自殺について考えることはない",
            "人生が空っぽに感じ、生きている価値があるかどうか疑問に思う",
            "自殺や死について、1週間に数回、数分間にわたって考えることがある",
            "自殺や死について1日に何回か細部にわたって考える、または、具体的な自殺の計画を立てたり、実際に死のうとしたりしたことがあった"
        ],
        "**Q13: 一般的な興味**": [
            "他人のことやいろいろな活動についての興味は普段と変わらない",
            "人々や活動について、普段より興味が薄れていると感じる",
            "以前好んでいた活動のうち、一つか二つのことにしか興味がなくなっていると感じる",
            "以前好んでいた活動に、ほとんどまったく興味がなくなっている"
        ],
        "**Q14: エネルギーのレベル**": [
            "普段のエネルギーのレベルと変わりない",
            "普段よりも疲れやすい",
            "普段の日常の活動(例えば、買い物、宿題、料理、出勤など)をやり始めたり、やりとげるのに、大きな努力が必要である",
            "ただエネルギーがないという理由だけで、日常の活動のほとんどが実行できない"
        ],
        "**Q15: 動作の遅れ**": [
            "普段どおりの速さで考えたり、話したり、動いたりしている",
            "頭の働きが遅くなっていたり、声が単調で平坦に感じる",
            "ほとんどの質問に答えるのに何秒かかかり、考えが遅くなっているのがわかる",
            "最大の努力をしないと、質問に答えられないことがしばしばである"
        ],
        "**Q16: 落ち着かなさ**": [
            "落ち着かない気持ちはない",
            "しばしばそわそわしていて、手をもんだり、座り直したりせずにはいられない",
            "動き回りたい衝動があって、かなり落ち着かない",
            "ときどき、座っていられなくて歩き回らずにはいられないことがある"
        ]
    }
    scores = {}
    unanswered = []
    for q_label, options in questions.items():
        answer = st.radio(q_label, options, index=None, key=q_label)
        if answer is not None:
            scores[q_label] = options.index(answer)
        else:
            unanswered.append(q_label)
    if st.button("回答を提出"):
        if unanswered:
            st.warning("以下の質問にまだ回答していません：")
            for q in unanswered:
                st.markdown(f"- {q}")
        else:
            st.session_state.qids_answers = scores
            st.success("回答ありがとうございました。")
            time.sleep(1)
            st.session_state.current_page = "attention"
            st.rerun()

else:
    st.session_state.current_page = "description"
    st.rerun()